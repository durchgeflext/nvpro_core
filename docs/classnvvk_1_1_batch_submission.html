<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>nvpro_core: nvvk::BatchSubmission Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">nvpro_core
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classnvvk_1_1_batch_submission.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classnvvk_1_1_batch_submission-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">nvvk::BatchSubmission Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;commands_vk.hpp&gt;</code></p>
<div class="dynheader">
Inheritance diagram for nvvk::BatchSubmission:</div>
<div class="dyncontent">
<div class="center"><img src="classnvvk_1_1_batch_submission__inherit__graph.png" border="0" usemap="#anvvk_1_1_batch_submission_inherit__map" alt="Inheritance graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8e4fbf75383d569f7290df8f913662a6"><td class="memItemLeft" align="right" valign="top"><a id="a8e4fbf75383d569f7290df8f913662a6"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>BatchSubmission</b> (<a class="el" href="classnvvk_1_1_batch_submission.html">BatchSubmission</a> const &amp;)=delete</td></tr>
<tr class="separator:a8e4fbf75383d569f7290df8f913662a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdd5e1f12b43983bd3a5c80c5108db78"><td class="memItemLeft" align="right" valign="top"><a id="abdd5e1f12b43983bd3a5c80c5108db78"></a>
<a class="el" href="classnvvk_1_1_batch_submission.html">BatchSubmission</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (<a class="el" href="classnvvk_1_1_batch_submission.html">BatchSubmission</a> const &amp;)=delete</td></tr>
<tr class="separator:abdd5e1f12b43983bd3a5c80c5108db78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a533d417b0581017bdb73400b0141fa3b"><td class="memItemLeft" align="right" valign="top"><a id="a533d417b0581017bdb73400b0141fa3b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>BatchSubmission</b> (VkQueue queue)</td></tr>
<tr class="separator:a533d417b0581017bdb73400b0141fa3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd2e8e3f875cc6b4b2feeea62e22f56e"><td class="memItemLeft" align="right" valign="top"><a id="abd2e8e3f875cc6b4b2feeea62e22f56e"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>getCommandBufferCount</b> () const</td></tr>
<tr class="separator:abd2e8e3f875cc6b4b2feeea62e22f56e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a864b36b3d00841a9490b092deced7211"><td class="memItemLeft" align="right" valign="top"><a id="a864b36b3d00841a9490b092deced7211"></a>
VkQueue&#160;</td><td class="memItemRight" valign="bottom"><b>getQueue</b> () const</td></tr>
<tr class="separator:a864b36b3d00841a9490b092deced7211"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afba32671500ece1abf9b9de52b373cf9"><td class="memItemLeft" align="right" valign="top"><a id="afba32671500ece1abf9b9de52b373cf9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>init</b> (VkQueue queue)</td></tr>
<tr class="separator:afba32671500ece1abf9b9de52b373cf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75652a23450945e70a199a54c3dd3a34"><td class="memItemLeft" align="right" valign="top"><a id="a75652a23450945e70a199a54c3dd3a34"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>enqueue</b> (uint32_t num, const VkCommandBuffer *cmdbuffers)</td></tr>
<tr class="separator:a75652a23450945e70a199a54c3dd3a34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2541cb73aec7f054489004a52929004"><td class="memItemLeft" align="right" valign="top"><a id="ac2541cb73aec7f054489004a52929004"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>enqueue</b> (VkCommandBuffer cmdbuffer)</td></tr>
<tr class="separator:ac2541cb73aec7f054489004a52929004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ab1a450305d16f7c3050702944892c2"><td class="memItemLeft" align="right" valign="top"><a id="a1ab1a450305d16f7c3050702944892c2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>enqueueSignal</b> (VkSemaphore sem)</td></tr>
<tr class="separator:a1ab1a450305d16f7c3050702944892c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b2907ef69bf93c9f5e9f259df7c3542"><td class="memItemLeft" align="right" valign="top"><a id="a6b2907ef69bf93c9f5e9f259df7c3542"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>enqueueWait</b> (VkSemaphore sem, VkPipelineStageFlags flag)</td></tr>
<tr class="separator:a6b2907ef69bf93c9f5e9f259df7c3542"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79fd24fd6970e1e0cd6c2772c0af2fa2"><td class="memItemLeft" align="right" valign="top"><a id="a79fd24fd6970e1e0cd6c2772c0af2fa2"></a>
VkResult&#160;</td><td class="memItemRight" valign="bottom"><b>execute</b> (VkFence fence=nullptr, uint32_t deviceMask=0)</td></tr>
<tr class="separator:a79fd24fd6970e1e0cd6c2772c0af2fa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1932ddb7f83938a9815f308a0f0b60b3"><td class="memItemLeft" align="right" valign="top"><a id="a1932ddb7f83938a9815f308a0f0b60b3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>waitIdle</b> () const</td></tr>
<tr class="separator:a1932ddb7f83938a9815f308a0f0b60b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>@DOC_START </p>
<h2><a class="anchor" id="autotoc_md175"></a>
class nvvk::RingCommandPool</h2>
<p>nvvk::RingCommandPool manages a fixed cycle set of VkCommandBufferPools and one-shot command buffers allocated from them.</p>
<p>The usage of multiple command buffer pools also means we get nice allocation behavior (linear allocation from frame start to frame end) without fragmentation. If we were using a single command pool over multiple frames, it could fragment easily.</p>
<p>You must ensure cycle is available manually, typically by keeping in sync with ring fences.</p>
<p>Example:</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">    frame++;</div>
<div class="line"> </div>
<div class="line">wait until we can use the <span class="keyword">new</span> cycle </div>
<div class="line">(very rare <span class="keywordflow">if</span> we use the fence at then end once per-frame)</div>
<div class="line">    ringFences.setCycleAndWait( frame );</div>
<div class="line"> </div>
<div class="line">update cycle state, allows recycling of old resources</div>
<div class="line">    ringPool.setCycle( frame );</div>
<div class="line"> </div>
<div class="line">    VkCommandBuffer cmd = ringPool.createCommandBuffer(...);</div>
<div class="line">    ... <span class="keywordflow">do</span> stuff / submit etc...</div>
<div class="line"> </div>
<div class="line">    VkFence fence = ringFences.getFence();</div>
<div class="line">use <span class="keyword">this</span> fence in the submit</div>
<div class="line">    vkQueueSubmit(...fence..);</div>
<div class="line">  }</div>
</div><!-- fragment --><p> @DOC_END */</p>
<p>class RingCommandPool { public: RingCommandPool(RingCommandPool const&amp;) = delete; RingCommandPool&amp; operator=(RingCommandPool const&amp;) = delete;</p>
<p>RingCommandPool(VkDevice device, uint32_t queueFamilyIndex, VkCommandPoolCreateFlags flags = VK_COMMAND_POOL_CREATE_TRANSIENT_BIT, uint32_t ringSize = DEFAULT_RING_SIZE) { init(device, queueFamilyIndex, flags, ringSize); } RingCommandPool() {} ~RingCommandPool() { deinit(); }</p>
<p>void init(VkDevice device, uint32_t queueFamilyIndex, VkCommandPoolCreateFlags flags = VK_COMMAND_POOL_CREATE_TRANSIENT_BIT, uint32_t ringSize = DEFAULT_RING_SIZE); void deinit();</p>
<p>void reset() { VkDevice device = m_device; VkCommandPoolCreateFlags flags = m_flags; uint32_t queueFamilyIndex = m_familyIndex; uint32_t ringSize = m_cycleSize; deinit(); init(device, queueFamilyIndex, flags, ringSize); }</p>
<p>// call when cycle has changed, prior creating command buffers // resets old pools etc. void setCycle(uint32_t cycle);</p>
<p>// ensure proper cycle or frame is set prior these VkCommandBuffer createCommandBuffer(VkCommandBufferLevel level = VK_COMMAND_BUFFER_LEVEL_PRIMARY, bool begin = true, VkCommandBufferUsageFlags flags = VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT, const VkCommandBufferInheritanceInfo* pInheritanceInfo = nullptr);</p>
<p>// pointer is only valid until next create const VkCommandBuffer* createCommandBuffers(VkCommandBufferLevel level, uint32_t count);</p>
<p>protected: struct Entry { VkCommandPool pool{}; std::vector&lt;VkCommandBuffer&gt; cmds; };</p>
<p>uint32_t m_cycleIndex{0}; uint32_t m_cycleSize{0}; std::vector&lt;Entry&gt; m_pools; VkDevice m_device = VK_NULL_HANDLE; VkCommandPoolCreateFlags m_flags{0}; uint32_t m_familyIndex{0}; };</p>
<p>//-----------------------------------------------------------------------------------------------&mdash; /** @DOC_START </p>
<h1><a class="anchor" id="autotoc_md176"></a>
class nvvk::BatchSubmission</h1>
<p><a class="el" href="classnvvk_1_1_batch_submission.html">nvvk::BatchSubmission</a> batches the submission arguments of VkSubmitInfo for VkQueueSubmit.</p>
<p>vkQueueSubmit is a rather costly operation (depending on OS) and should be avoided to be done too often (e.g. &lt; 10 per frame). Therefore this utility class allows adding commandbuffers, semaphores etc. and submit them later in a batch.</p>
<p>When using manual locks, it can also be useful to feed commandbuffers from different threads and then later kick it off.</p>
<p>Example</p>
<div class="fragment"><div class="line"><span class="comment">// within upload logic</span></div>
<div class="line">{</div>
<div class="line">  semTransfer = handleUpload(...);</div>
<div class="line">  <span class="comment">// for example trigger async upload on transfer queue here</span></div>
<div class="line">  vkQueueSubmit(... semTransfer ...);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// tell next frame&#39;s batch submission </span></div>
<div class="line">  <span class="comment">// that its commandbuffers should wait for transfer</span></div>
<div class="line">  <span class="comment">// to be completed</span></div>
<div class="line">  graphicsSubmission.enqueWait(semTransfer)</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// within present logic</span></div>
<div class="line">{</div>
<div class="line">  <span class="comment">// for example ensure the next frame waits until proper present semaphore was triggered</span></div>
<div class="line">  graphicsSubmission.enqueueWait(presentSemaphore);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// within drawing logic</span></div>
<div class="line">{</div>
<div class="line">  <span class="comment">// enqueue some graphics work for submission</span></div>
<div class="line">  graphicsSubmission.enqueue(getSceneCmdBuffer());</div>
<div class="line">  graphicsSubmission.enqueue(getUiCmdBuffer());</div>
<div class="line"> </div>
<div class="line">  graphicsSubmission.execute(frameFence);</div>
<div class="line">}</div>
</div><!-- fragment --><p> @DOC_END </p>
</div><hr/>The documentation for this class was generated from the following files:<ul>
<li>commands_vk.hpp</li>
<li>commands_vk.cpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacenvvk.html">nvvk</a></li><li class="navelem"><a class="el" href="classnvvk_1_1_batch_submission.html">BatchSubmission</a></li>
    <li class="footer">Generated on Thu Apr 3 2025 15:13:48 for nvpro_core by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
